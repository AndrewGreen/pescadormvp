<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="es">
<head>
<!-- Generated by javadoc (version 1.7.0_25) on Sat Aug 03 08:31:13 CDT 2013 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>mx.org.pescadormvp.examples.jsonp.client (Pescador MVP Parent 1.0-SNAPSHOT API)</title>
<meta name="date" content="2013-08-03">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="mx.org.pescadormvp.examples.jsonp.client (Pescador MVP Parent 1.0-SNAPSHOT API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../mx/org/pescadormvp/core/shared/package-summary.html">Prev Package</a></li>
<li><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?mx/org/pescadormvp/examples/jsonp/client/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;mx.org.pescadormvp.examples.jsonp.client</h1>
</div>
<div class="contentContainer">
<a name="package_description">
<!--   -->
</a>
<h2 title="JSONP Example">JSONP Example</h2>
<div class="block"><p>
 JSONP Example is a sample application that demonstrates basic Pescador MVP
 usage.
 </p>
 <p>
 The application asks the user to enter a place name. Then, it fetches the
 place's latitude and longitude via a JSONP request to OpenStreetMap, and
 displays a map using OpenLayers. <a href=
 "http://andrewgreen.github.io/pescadormvp/site/examples/jsonp/live/index.html"
 >Here it is</a>, compiled and running in your browser.
 </p>
 <p>
 This document explains how it works.
 </p>
 <p>
 (Note: a shorter <a href="../../../core/package-summary.html">overview of
 Pescador MVP</a> is also available.)
 </p>
 <h4>Contents:</h4>
 <ol>
 <li><a href="#component">The Query Component</a></li>
 <li><a href="#generalqcstuff">General Query Component Stuff</a></li>
 <li><a href="#queryactivity">The Query Activity</a></li>
 <li><a href="#queryview">The Query View</a></li>
 <li><a href="#map">The Map Widget</a></li>
 <li><a href="#queryplace">The Query Place</a></li>
 <li><a href="#actionhelper">The JSONP Action Helper</a></li>
 <li><a href="#layout">Application Layout</a></li>
 <li><a href="#globalsetup">Global Setup</a></li>
 <li><a href="#frameworkstartup">Starting Up the Framework</a></li>
 <li><a href="#tests">Tests</a></li>
 </ol>
 <h3><a name="component"/>The Query Component</h3>
 <p>
 In Pescador MVP, you create a component by grouping some classes together in
 a package, and making one of those classes implement the
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a> interface.
 </p>
 <p>
 The JSONP Example application is so simple that it has only one component:
 "Query". All the classes that are part of this component are in the
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/package-summary.html"><code>...examples.jsonp.client.query</code></a> package.
 </p>
 <p>
 Since we're using dependency injection, we want variables to refer to
 interfaces, rather than concrete classes, as much as possible. So, the public
 methods of almost every concrete class are set out in a corresponding
 interface, which is used in variable definitions. Interfaces have nearly the
 same names as the concrete classes that implement them (the difference is
 just that concrete class names have an "Impl" on the end).
 </p>
 <p>
 Here are the Query Component's interface-implementation pairs:
 </p>
 <table class="packageSummary" border="0" cellpadding="3" cellspacing="0">
 <tr>
 <th class="colFirst" scope="col">Interface</th>
 <th class="colFirst" scope="col">Implementation</th>
 <th class="colOne" scope="col">Description</th>
 </tr>
 <tbody>
 <tr class="rowColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html"
 > QueryComponent</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html"
 > QueryComponentImpl</a></td>
 <td class="colOne"><div class="block">General Query Component stuff.</div></td>
 </tr>
 <tr class="altColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivity.html"
 > QueryActivity</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivityImpl.html"
 > QueryActivityImpl</a></td>
 <td class="colOne"><div class="block">The activity that this component
 provides for the main (and only) region of the UI.</div></td>
 </tr>
 <tr class="rowColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryView.html"
 > QueryView</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryViewImpl.html"
 > QueryViewImpl</a></td>
 <td class="colOne"><div class="block">The view that this component provides
 for the main (and only) region of the UI.</div></td>
 </tr>
 <tr class="altColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/OSMMap.html"
 > OSMMap</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/OSMMapImpl.html"
 > OSMMapImpl</a></td>
 <td class="colOne"><div class="block">The map widget.</div></td>
 </tr>
 <tr class="rowColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html"
 > QueryPlace</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlaceImpl.html"
 > QueryPlaceImpl</a></td>
 <td class="colOne"><div class="block">The place associated with this
 component.</div></td>
 </tr>
 <tr class="altColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/GetLatLonActionHelper.html"
 > GetLatLonActionHelper</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/GetLatLonActionHelperImpl.html"
 > GetLatLonActionHelperImpl</a></td>
 <td class="colOne"><div class="block">A helper for performing JSONP requests
 to OpenStreetMap.</div></td>
 </tr>
 </tbody>
 </table>
 <p>
 Let's look at each of these pairs.
 </p>
 <h3><a name="generalqcstuff"/>General Query Component Stuff</h3>
 <p>
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>
 takes responsibility for everything of general interest to the Query
 Component. One such responsibility is the implementation
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a>&mdash;Pescador
 MVP requires that all components include an implementation of that interface.
 </p>
 <p>
 However, Query Component is not just an ordinary component&mdash;it's a
 "place-activity-view" (PAV) component. That is, it's a special kind of
 component that associates a place class with one or more activity classes,
 view classes, and regions of the UI. Pescador MVP requires that PAV
 components include an implementation of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a> (a
 subinterface of <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a>).
 </p>
 <p>
 The <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a>
 interface is a subinterface of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a> . So
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>, by
 implementing
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a>, also
 implements
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a> and
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a>.
 </p>
 <p>
 Here is the definition of
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a>:
 </p>
 
 <pre>
 <code class=java>
     public interface QueryComponent extends PAVComponent&lt;
             QueryComponent, 
             QueryPlace>,
             RawDefaultPlaceProvider { }
 </code>
 </pre>
 <p>
 As you can see,
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a> fills
 in the generic parameters of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a> .
 (For now, don't worry about the reference to
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/RawDefaultPlaceProvider.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>RawDefaultPlaceProvider</code></a>
 &mdash;it'll be explained in a <a href="#globalsetup">moment</a>.) The
 opening line of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a> goes
 like this:
 </p>
 
 <pre>
 <code class=java>
     public interface PAVComponent&lt;
             I extends PAVComponent&lt;I,P>, // component's interface
             P extends PescadorMVPPlace>  // place
             extends Component&lt;I>
 </code>
 </pre>
 <p>
 Now let's look at the implementation,
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>,
 which starts out like this:
 </p>
 
 <pre>
 <code class=java>
     public class QueryComponentImpl extends PAVComponentBase&lt; 
             QueryComponent,
             QueryPlace>
             implements
             QueryComponent
 </code>
 </pre>
 <p>
 By extending
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponentBase.html" title="class in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponentBase</code></a>
 (as all PAV components should)
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>
 gains access to many convenience methods for dealing with places, activities
 and UI regions.
 </p>
 <p>
 What actual logic goes in
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>?
 First, in Pescador MVP, if a component provides any extra functionality to
 other parts of the system, that functionality should be made available via
 the class that implements
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a> (in this case,
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>).
 The Query Component offers only one method of this sort,
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html#getRawDefaultPlace()"><code>getRawDefaultPlace()</code></a>, which provides the application's default place. (More
 about this <a href="#globalsetup">below</a>.)
 </p>
 <p>
 Dependency injection bindings also are of general interest to the component,
 so they, too, should be placed in the class that implements
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a>.
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>
 contains a static inner class that implements
 <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/GinModule.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>GinModule</code></a> and sets all the component's
 DI bindings:
 </p>
 
 <pre>
 <code class=java>
     public static class QueryGinModule extends AbstractGinModule {
 
         @Override
         protected void configure() {
             // Bind the component interface to its implementation
             // (which is the enclosing class).
             // This is something all components will do.
             bind(QueryComponent.class).
                     to(QueryComponentImpl.class).in(Singleton.class);
 
             // Create the place factory.
             // All place-activity-view components will do this.
             install(new GinFactoryModuleBuilder().implement(
                     QueryPlace.class, QueryPlaceImpl.class)
                     .build(
                     new TypeLiteral&lt;
                     RawPlaceFactory&lt;QueryPlace>>(){}));
 
             // The next two bindings are for the activity and the view.
             // Place-activity-view components will have bindings like these 
             // for each activity and view they define.
             // (This component has only one activity and one view.)
             
             // Create the activities factory.
             install(new GinFactoryModuleBuilder().implement(
                     QueryActivity.class, QueryActivityImpl.class)
                     .build(
                     new TypeLiteral&lt;
                     ActivitiesFactory&lt;QueryPlace, QueryActivity>>(){}));
             
             // Bind the view.
             bind(QueryView.class).to(QueryViewImpl.class)
                     .in(Singleton.class);
             
             // The remaining bindings are specific to this component.
             // Other place-activity-view components may or may not have
             // additional bindings like these, depending on what they do.
             
             // Bind JSONP action helper.
             // Any component that sets up JSONP requests will do something
             // like this.
             bind(GetLatLonActionHelper.class)
                     .to(GetLatLonActionHelperImpl.class)
                     .in(Singleton.class);
             
             // Bind OSMMap widget.
             bind(OSMMap.class).to(OSMMapImpl.class).in(Singleton.class);
         }
     }
 </code>
 </pre>
 <p>
 The remaining general setup is performed in
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>'s
 constructor:
 </p>
 
 <pre>
 <code class=java>
     @Inject
     public QueryComponentImpl(
             ActivitiesFactory&lt;QueryPlace, QueryActivity> activitiesFactory,
             GetLatLonActionHelper actionHelper,
             DataManager dataManager) {
         
         // Establish that this component has an activity for the
         // Layout.Body screen region (in this app, that's the only region).
         addRegionAndActivitiesFactory(Body.class, activitiesFactory);
 
         // register JSONP action helper for getting lat-lon data
         dataManager.registerActionHelper(actionHelper);
     }
 </code>
 </pre>
 <p>
 Here, we link the UI region
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/Layout.Body.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.layout"><code>Layout.Body</code></a> to the activities factory we created in our
 <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/GinModule.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>GinModule</code></a> (see above). This tells the
 framework to activate the
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivity.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryActivity</code></a> and
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryView.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryView</code></a> in the
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/Layout.Body.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.layout"><code>Layout.Body</code></a> UI region when the application goes to
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlace</code></a>.
 </p>
 <p>
 Finally, we register a
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/JsonpActionHelper.html" title="interface in mx.org.pescadormvp.core.client.data"><code>JsonpActionHelper</code></a> with the
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a>. This is necessary
 for the JSONP requests the component will perform (more about
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/JsonpActionHelper.html" title="interface in mx.org.pescadormvp.core.client.data"><code>JsonpActionHelper</code></a>s <a
 href="#actionhelper">below</a>).
 </p>
 <p>
 If you find all of the above a bit boilerplatey, you're right! Admittedly, it
 would be possible to set up some fancy code generation to make PAV component
 creation easier. Nonetheless, it's not an onerous amount of boilerplate, and
 it does help you organize your dependency-injected MVP-architected code.
 </p>
 <h3><a name="queryactivity"/>The Query Activity</h3>
 <p>
 This is the fun part: the activity. Here's the constructor:
 </p>
 
 <pre>
 <code class=java>
        @Inject
        public QueryActivityImpl(
                        QueryComponent queryComponent,
                        QueryMessages messages,
                        OSMMap map,
                        DataManager dataManager,
                        PescadorMVPLogger logger) {
 
                this.queryComponent = queryComponent;
                this.messages = messages;
                this.map = map;
                this.dataManager = dataManager;
                this.logger = logger;
        }
 </code>
 </pre>
 <p>
 OK, that's pretty straightforward. We get everything we need via DI and store
 it all in instance variables.
 </p>
 <p>
 The activity's
 <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/activity/shared/Activity.html?is-external=true#start(com.google.gwt.user.client.ui.AcceptsOneWidget, com.google.gwt.event.shared.EventBus)" title="class or interface in com.google.gwt.activity.shared"><code>start()</code></a> method is also unsurprising&mdash;after all, this is a standard GWT
 <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/activity/shared/Activity.html?is-external=true" title="class or interface in com.google.gwt.activity.shared"><code>Activity</code></a>:
 </p>
 
 <pre>
 <code class=java>
     @Override
     public void start(AcceptsOneWidget container, EventBus eventBus) {
 
         // Attach the view to the container for the only UI region
         QueryView view = getView(); 
         contaier.setWidget(view);
         ...
 </code>
 </pre>
 <p>
 The only unusual thing here is that we conveniently have access to our view
 via the
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPActivityBase.html#getView()"><code>getView()</code></a> method (available to us because the activity extends
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlaceActivityBase.html" title="class in mx.org.pescadormvp.core.client.placesandactivities"><code>PescadorMVPPlaceActivityBase</code></a>
 , as required).
 </p>
 <p>
 Standard Pescador MVP fare is to have the activity push to and control the
 view. The view doesn't do anything except control UI details and fire off
 events.
 </p>
 <p>
 The first thing we do with our passive view is ask it if the query area
 (where the user will enter information) has been rendered. If it hasn't, we
 tell the view to render it.
 </p>
 
 <pre>
 <code class=java>
         if (!view.isQueryAreaRendered()) {
 
             view.renderQueryArea(
                     messages.beforeQueryTextBox(),
                     messages.afterQueryTextBox());
         }
 </code>
 </pre>
 <p>
 Then, we register to receive events from the view, and call
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivityImpl.html#doQuery()"><code>doQuery()</code></a> (where the real action takes place):
 </p>
 
 <pre>
 <code class=java>
         linkHandlerReg = eventBus.addHandlerToSource(
                 PlaceRequestEvent.TYPE,
                 view, this);
 
          doQuery();
      }
 </code>
 </pre>
 <p>
 Note that <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryView.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryView</code></a>
 has five renderable states:
 </p>
 <ol>
 <li><i>Empty</i>&nbsp;&nbsp;&nbsp;In this state, no messages or information
 are shown.</li>
 <li><i>Loading</i>&nbsp;&nbsp;&nbsp;The view displays a message saying that
 the requested information is loading.</li>
 <li><i>Error</i>&nbsp;&nbsp;&nbsp;The view displays a message explaining that
 there was an error communicating with the server.</li>
 <li><i>Lat-lon</i>&nbsp;&nbsp;&nbsp;The view displays a place's latitude and
 longitude, and a map.</li>
 <li><i>No such place</i>&nbsp;&nbsp;&nbsp;The view displays a message
 explaining that no place was found with the name entered.</li>
 </ol>
 <p>
 It's the activity's responsibility to tell the view which state to render,
 and to provide it with the information it needs to do so.
 </p>
 <p>
 So, in
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivityImpl.html#doQuery()"><code>doQuery()</code></a>, the activity first gets the name of the location the user wants
 to hear about. It gets this information from the current
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlace</code></a> instance,
 available via the
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlaceActivityBase.html#getPlace()"><code>getPlace()</code></a> method. If the current Place has no information on this, then the
 activity tells the view to render an empty state.
 </p>
 
 <pre>
 <code class=java>
         final String location = getPlace().getLocation();
         
         // If there's no location data, set up the view as "empty"
         if ((location == null) || (location.length() == 0)) {
             view.setTextboxContents("");
             view.renderEmpty();
 </code>
 </pre>
 <p>
 On the other hand, if the
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlace</code></a> <b>does</b>
 have the name of a location to be queried, then the activity sends a request
 to the <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a>, and decides
 what to do on the basis of the result. Here's the code:
 </p>
 
 <pre>
 <code class=java>
         } else {
             
             // Make sure the text box contains the location string the user asked for
             // We don't sanitize it here, that's for the view to do
             view.setTextboxContents(location);
             
             // Before trying to retrieve information,
             // set a timer to display a "Loading" message if the request
             // doesn't come back quickly. The view will cancel the timer
             // once any state is rendered.
             view.setLoadingString(messages.loading());
             view.scheduleLoadingMessage();
                         
             // Create an action object with the name of the location to query
             GetLatLonAction action = new GetLatLonAction(location);
             
             // Perform the request
             dataManager.execute(action, GetLatLonResult.class,
                     new AsyncCallback&lt;GetLatLonResult>() {
     
                 @Override
                 public void onFailure(Throwable caught) {
                     
                     // Log the error
                     logger.log(Level.WARNING, caught.getLocalizedMessage());
                     
                     // Notify the user
                     view.setErrorStrings(messages.errorCommunicating(),
                             messages.tryAgain());
                     view.renderError();
                 }
         
                 @Override
                 public void onSuccess(GetLatLonResult result) {
                     
                     if (result.hasData()) {
                         
                         double lat = result.getLat();
                         double lon = result.getLon();
                         
                         String latNSStr = lat > 0 ? "N" : "S";
                         String latStr = Math.abs(lat) + " " + latNSStr;
                         
                         String lonEWStr = lon > 0 ? "E" : "W";
                         String lonStr = Math.abs(lon) + " " + lonEWStr;
                         
                         String info = messages.XisAtY(
                                 result.getDisplayName(), latStr, lonStr);
                         
                         // Send the info to the view
                         view.setLatLonMsg(info);
                         
                         // Ensure the view has the map it will use
                         if (!view.osmMapSet())
                             view.setOSMMap(map);
                         
                         // Set the map to the correct location
                         map.setLatLon(lat, lon);
                         
                         // Tell the view to render
                         view.renderLatLon();
 
                     } else {
                         
                         view.setNoSuchPlaceStrings(
                                 messages.neverHeardOf(location),
                                 messages.tryAgain());
                         
                         view.renderNoSuchPlace();
                     }
                 }
             });
         }
 </code>
 </pre>
 <p>
 In summary, we tell the view to set the contents of the text box with the
 name of the location being queried, and to start a timer and render the
 Loading state if it doesn't hear back from us right away. Then we create a
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/GetLatLonAction.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>GetLatLonAction</code></a> with
 the name of the location to query, and send it to the (third-party) server
 via the <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a>. When the
 request comes back, we tell the view to render Error, Lat-lon or No such
 place, depending on the result. We also provide the view with the localized
 messages it needs to do this. If the Lat-lon state is to be rendered, we also
 do a bit of string processing, set the map location and make sure the view
 has the required map widget (
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/OSMMap.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>OSMMap</code></a>&mdash; see <a
 href="#map">below</a>).
 </p>
 <p>
 In truth, there's not much extraordinary about this activity. The most
 significant things about it are: we get everything we need via DI and methods
 provided by the superclass, push to the view and handle events from it, and
 send requests via a handy
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a> that uses the command
 pattern (more on that <a href="#actionhelper">in a minute</a>).
 </p>
 <h3><a name="queryview"/>The Query View</h3>
 <p>
 There's really nothing framework-specific about the view in this example app.
 It's implemented as a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/user/client/ui/ResizeComposite.html?is-external=true" title="class or interface in com.google.gwt.user.client.ui"><code>ResizeComposite</code></a>
 and uses standard GWT facilities like UiBinder, client bundles, sprites,
 <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/safehtml/client/SafeHtmlTemplates.html?is-external=true" title="class or interface in com.google.gwt.safehtml.client"><code>SafeHtmlTemplates</code></a> and animation. Check
 it out if you're interested in how it uses those things.
 </p>
 <p>
 This view knows nothing about the activity that controls it. It just provides
 methods that the activity accesses, and fires off events. There's only one
 non-display-related task that it's allowed to handle: setting data in
 <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/place/shared/Place.html?is-external=true" title="class or interface in com.google.gwt.place.shared"><code>Place</code></a> objects.
 </p>
 <h3><a name="map"/>The Map Widget</h3>
 <p>
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/OSMMapImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>OSMMapImpl</code></a> is a small
 wrapper for the OpenLayers
 <a href="http://www.gwt-openlayers.org/apidocs/org/gwtopenmaps/openlayers/client/MapWidget.html?is-external=true" title="class or interface in org.gwtopenmaps.openlayers.client"><code>MapWidget</code></a>. It's been kept separate
 from the view and the activity because it contains a bit of logic related to
 map rendering that doesn't fit in either. The activity controls it and sends
 it to the view for attachment at the appropriate spot in the UI.
 </p>
 <h3><a name="queryplace"/>The Query Place</h3>
 <p>
 In Pescador MVP, Places do have quite a bit of specialness: they're passed
 around as interfaces rather than concrete classes, can store information in
 key-value pairs, and have extra fields that are useful for creating
 hyperlinks. Let's look at all these features.
 </p>
 <p>
 Here's the code for
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlaceImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlaceImpl</code></a>:
 </p>
 
 <pre>
  <code class=java>
      public class QueryPlaceImpl extends PescadorMVPPlaceBase implements QueryPlace {
      
          private static final String MAIN_TOKEN = "query";
          private static final String LOCATION_KEY = "l";
          
          private String location;
          
          public QueryPlaceImpl() {
          
              // Tell the superclass about the main token and the only
              // key.
              super(MAIN_TOKEN, new String[] { LOCATION_KEY });
          }
          
          /**
           * This method is called by the superclass whenever a property needs to be
           * set.
           */
          @Override
          protected void processProperty(String key, String value) {
              if (key.compareTo(LOCATION_KEY) == 0) {
                  location = value;
              } 
          }
      
          @Override
          public String getLocation() {
              return location;
          }
 
          /**
           * Here, instead of setting our instance variable directly, we tell the
           * superclass to follow its standard procedure for setting a property.
           */
          @Override
          public void setLocation(String location) {
              setProperty(LOCATION_KEY, location);
          }
      }
  </code>
 </pre>
 <p>
 All Pescador MVP facilities expect places to be subinterfaces of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlace.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PescadorMVPPlace</code></a>,
 which <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlace</code></a> is.
 Refering to places as interfaces rather than concrete (or even abstract)
 classes allows more flexibility, since interfaces can handle multiple
 inheritance. (So, for example, if you have code that needs to deal with a
 specific set of places, you can use a tag interface that may or may not
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlace.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PescadorMVPPlace</code></a>.)
 </p>
 <p>
 At the same time, all implementations of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlace.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PescadorMVPPlace</code></a>
 should also extend
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlaceBase.html" title="class in mx.org.pescadormvp.core.client.placesandactivities"><code>PescadorMVPPlaceBase</code></a>
 , which itself extends GWT's <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/place/shared/Place.html?is-external=true" title="class or interface in com.google.gwt.place.shared"><code>Place</code></a>. That
 means
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlace.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PescadorMVPPlace</code></a>s
 are always GWT <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/place/shared/Place.html?is-external=true" title="class or interface in com.google.gwt.place.shared"><code>Place</code></a>s, too. They can be
 gotten as such via the
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlace.html#asGWTPlace()"><code>asGWTPlace()</code></a> method.
 </p>
 <p>
 As you can see, there's not much logic in
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlaceImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlaceImpl</code></a>. In the
 constructor, we send the superclass the main token and keys to be used in the
 URL fragment identifier. There is a getter and a setter for location, which
 holds the name of the location the user wants to query. In the setter,
 instead of setting our instance variable directly, we call
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlaceBase.html#setProperty(java.lang.String, java.lang.String)"><code>setProperty(String, String)</code></a>, as shown. This call will eventually get back to
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlaceBase.html#processProperty(java.lang.String, java.lang.String)"><code>processProperty(String, String)</code></a>, which we must implement. That's where we
 set the instance variable, also as shown.
 </p>
 <p>
 By doing things this way, we can give our places simple getters and setters
 for the data they store, and allow the framework to serialize and deserailize
 place state to and from URL fragment identifiers. In the case of
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlace</code></a>, a query
 for "London", for example, translates to the following fragment identifier: "
 <code>#query;l=London</code>". (So with Pescador MVP, you don't have to write
 any <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/place/shared/PlaceTokenizer.html?is-external=true" title="class or interface in com.google.gwt.place.shared"><code>PlaceTokenizer</code></a>s.)
 </p>
 <p>
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlace.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PescadorMVPPlace</code></a>s
 can hold the following additional information: a locale, a history token
 (that is, the URL fragment identifier without the "#"), a full URL, and
 presentation text. All this is useful mostly with the framework's facilities
 for creating internal hyperlinks (see
 <a href="../../../../../../mx/org/pescadormvp/core/client/internallinks/package-summary.html"><code>...core.client.internallinks</code></a>). (BTW, there are parts of the framework where
 places are refered to as "raw"&mdash;that just means that they haven't had
 any of this additional information set up yet.)
 </p>
 <h3><a name="actionhelper"/>The JSONP Action Helper</h3>
 <p>
 Pescador MVP includes a caching command-pattern
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a> (based on <a
 href="http://code.google.com/p/gwt-dispatch/">gwt-dispatch</a> and a <a href=
 "http://turbomanage.wordpress.com/2010/07/12/caching-batching-dispatcher-for-gwt-dispatch/"
 > blog post by David Chandler</a>). It doesn't have much to do with MVP, but
 it's still kinda useful.
 </p>
 <p>
 Normally, server calls go to your own server. The
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a> manages such calls
 via standard gwt-dispatch <code>Action</code>
 and <code>Result</code> classes. To handle them
 on the server, you implement
 <code>ActionHandler</code>s, as
 per the <a href="http://code.google.com/p/gwt-dispatch/wiki/GettingStarted">
 gwt-dispatch documentation</a>.
 </p>
 <p>
 Pescador MVP also lets you use the command pattern for calls to third-party
 servers via JSONP. In that case, instead of implementing an
 <code>ActionHandler</code>, you
 create a <a href="../../../../../../mx/org/pescadormvp/core/client/data/JsonpActionHelper.html" title="interface in mx.org.pescadormvp.core.client.data"><code>JsonpActionHelper</code></a> that
 encapsulates details of the server call, including the creation of a
 <code>Result</code> instance.
 </p>
 <p>
 Here is the example app's
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/JsonpActionHelper.html" title="interface in mx.org.pescadormvp.core.client.data"><code>JsonpActionHelper</code></a>,
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/GetLatLonActionHelperImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>GetLatLonActionHelperImpl</code></a>
 :
 </p>
 
 <pre>
 <code class=java>
  public class GetLatLonActionHelperImpl 
             implements GetLatLonActionHelper {
     
         final static String BASE_URL = "http://nominatim.openstreetmap.org/search?format=json&limit=1&q=";
         final static String CALLBACK_PARAM ="json_callback";
 
         /**
          * Create the Result from the received JavaScriptObject.
          */
         @Override
         public GetLatLonResult insantiateResult(JavaScriptObject jsResult) {
     
             LatLonInfo latLonInfo = jsResult.cast();
             GetLatLonResult result = new GetLatLonResult();
             
             result.setValid(latLonInfo.getCount() > 0);
             
             if (result.isValid()) {
                 result.setDisplayName(latLonInfo.getDisplayName());
                 result.setLat(Double.valueOf(latLonInfo.getLat()));
                 result.setLon(Double.valueOf(latLonInfo.getLon()));
             }
     
             return result;
         }
     
         @Override
         public String getRequestURL(GetLatLonAction action) {
             return UriUtils.sanitizeUri(BASE_URL + action.getLocation());
         }
     
         @Override
         public String getCallbackParameter() {
             return CALLBACK_PARAM;
         }
         
         @Override
         public Class<GetLatLonAction> getActionType() {
             return GetLatLonAction.class;
         }
         
         /**
          * Overlay Java type for accessing contents of Javascript object
          * returned over JSONP.
          */
         static private class LatLonInfo extends JavaScriptObject {
     
             protected LatLonInfo() {}
             
             public final native int getCount() /*-{
                 return this.length;
             }-*/;
             
             public final native String getDisplayName() /*-{
                 return this[0].display_name;
             }-*/;
             
             public final native String getLat() /*-{
                 return this[0].lat;
             }-*/;
             
             public final native String getLon() /*-{
                 return this[0].lon;
             }-*/;
         }
     }
 </code>
 </pre>
 <p>
 Remember that <a href="../../../../../../mx/org/pescadormvp/core/client/data/JsonpActionHelper.html" title="interface in mx.org.pescadormvp.core.client.data"><code>JsonpActionHelper</code></a>s
 must be registered with the
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a>, as we <a
 href="#generalqcstuff">saw earlier</a>.
 </p>
 <p>
 Also, note that for an action's result to be cached, the action must
 implement <a href="../../../../../../mx/org/pescadormvp/core/client/data/CacheableAction.html" title="interface in mx.org.pescadormvp.core.client.data"><code>CacheableAction</code></a>.
 </p>
 <h3><a name="layout"/>Application Layout</h3>
 <p>
 Pescacdor MVP is basically agnostic about how you lay out your application.
 It does, however make a few simple assumptions&mdash;namely, that your app
 has regions, and that each region has a container widget.
 </p>
 <p>
 (However, the regions' dimensions need not remain static, and regions are not
 required to always be visible. It's also possible to have UI elements that
 are logically contained in a region without being visually tied to it.)
 </p>
 <p>
 The framework's assumptions about regions are embodied in the
 <a href="../../../../../../mx/org/pescadormvp/core/client/regionsandcontainers/RootHasFixedSetOfRegions.html" title="interface in mx.org.pescadormvp.core.client.regionsandcontainers"><code>RootHasFixedSetOfRegions</code></a>
 interface. Applications must provide an implementation of that interface.
 Here is the very simple implementation used in the example app:
 </p>
 
 <pre>
 <code class=java>
 public class LayoutImpl extends ResizeComposite implements Layout {
     
        private SimpleLayoutPanel outer = new SimpleLayoutPanel();
        private DynamicSimpleLayoutPanel body = new DynamicSimpleLayoutPanel();
        
        private LayoutHelper layoutHelper;
        
        @Inject
        public LayoutImpl(LayoutHelper layoutHelper) {
           this.layoutHelper = layoutHelper;
           
           // set up region(s)
           layoutHelper.setupRegion(Body.class, body);
     
           // take up the whole viewport
           body.setWidth("100%");
           body.setHeight("100%");
           outer.setWidth("100%");
           outer.setHeight("100%");
           
           outer.add(body);
           
           // required call for all children of GWT's Composite widget
           initWidget(outer);
        }
        
        @Override
        public void attach() {
           RootLayoutPanel rootLayoutPanel = RootLayoutPanel.get();
           rootLayoutPanel.add(this);
           onResize(); // make sure everything's the right size
        }
     
        @Override
        public Set&lt;Class&lt;? extends ForRegionTag>> getRegions() {
           return layoutHelper.getRegions();
        }
     
        @Override
        public DynamicContainer
              getContainer(Class&lt;? extends ForRegionTag> regionTag) {
           return layoutHelper.getContainer(regionTag);
        }
     }
 </code>
 </pre>
 <p>
 So there you go: one region (
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/Layout.Body.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.layout"><code>Body</code></a>),
 one container, an
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/LayoutImpl.html#attach()"><code>attach()</code></a> method, and some boilerplate hidden away by
 <a href="../../../../../../mx/org/pescadormvp/core/client/regionsandcontainers/LayoutHelper.html" title="class in mx.org.pescadormvp.core.client.regionsandcontainers"><code>LayoutHelper</code></a>.
 </p>
 <h3><a name="globalsetup"/>Global Setup</h3>
 <p>
 So far we've seen how to create a PAV component, a
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/JsonpActionHelper.html" title="interface in mx.org.pescadormvp.core.client.data"><code>JsonpActionHelper</code></a> and a global
 layout widget. Now let's look at Pescador MVP's facilities for global
 application setup.
 </p>
 <p>
 Just as the setup of each component is contained in a single class, global
 application setup is also done in a single class&mdash;which must be a
 subclass of <a href="../../../../../../mx/org/pescadormvp/core/client/components/GlobalSetup.html" title="class in mx.org.pescadormvp.core.client.components"><code>GlobalSetup</code></a>. In
 the example app, the class used for global setup is
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveGlobalSetup.html" title="class in mx.org.pescadormvp.examples.jsonp.client"><code>ActiveGlobalSetup</code></a>.
 </p>
 <p>
 An important part of global setup is DI binding. There will normally be some
 bindings that are truly global, rather than being tied to a given component.
 In the example app, global bindings are set in a static inner class within
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveGlobalSetup.html" title="class in mx.org.pescadormvp.examples.jsonp.client"><code>ActiveGlobalSetup</code></a>:
 </p>
 
 <pre>
 <code class=java>
     public static class ActiveGlobalSetupGinModule extends AbstractGinModule {
         @Override
         protected void configure() {
             
             // global setup
             bind(GlobalSetup.class).to(ActiveGlobalSetup.class)
                     .in(Singleton.class);
 
             // global layout widget
             bind(Layout.class).to(LayoutImpl.class).in(Singleton.class);
 
             // WARNING: in the next two bindings, it's important to bind
             // to interfaces, not implementations.
 
             // tell the framework that this is our global layout widget
             bind(RootHasFixedSetOfRegions.class).to(Layout.class);
             
             // tell the framework that this is our default place provider
             bind(RawDefaultPlaceProvider.class).to(QueryComponent.class);
         }
 
         // An example of Guice-style global configurations:
         // set the max cache size for the DataManager.
         @Provides
         @Named("maxDataManagerCacheSize")
         Integer providesMaxDataManagerCacheSize() {
             return 50;
         }
     }
 </code>
 </pre>
 <p>
 First we bind the enclosing class, then the global layout widget, then tell
 the framework that that widget is to be used for global layout.
 </p>
 <p>
 The fourth binding tells the framework that
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a> will
 provide the application's default place. That means that if there is no URL
 fragment identifier, or if there is a fragment identifier that framework is
 unable to interpret, the application will go to the place provided by
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>'s
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/RawDefaultPlaceProvider.html#getRawDefaultPlace()"><code>getRawDefaultPlace()</code></a> method. (That's why the
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a>
 interface extends
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/RawDefaultPlaceProvider.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>RawDefaultPlaceProvider</code></a>
 , as we <a href="#generalqcstuff">saw earlier</a>.)
 </p>
 <p>
 The last few lines of the above code show how to use binding annotations to
 set global configuration values. Here we override the
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a>'s default maximum
 cache size, setting it to 50. (Normally, there's no need to do this&mdash;the
 default value should be fine.)
 </p>
 <p>
 To complete DI setup, we define a
 <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/Ginjector.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>Ginjector</code></a> interface and bring in all the
 <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/GinModule.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>GinModule</code></a>s containing bindings we want
 to use. In the example app, we do this with an inner interface inside
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveGlobalSetup.html" title="class in mx.org.pescadormvp.examples.jsonp.client"><code>ActiveGlobalSetup</code></a>:
 </p>
 
 <pre>
 <code class=java>
     @GinModules({
         // Global bindings for this app that are not part of any component
         ActiveGlobalSetupGinModule.class,
         
         // Bindings for the Query Component
         QueryGinModule.class,
         
         // Modules required by the framework
         PescadorMVPGinModule.class,
         StandardDispatchModule.class
     })
     public interface ActiveGlobalSetupGinjector extends PescadorMVPGinjector {}
 </code>
 </pre>
 <p>
 The last two modules are required and should be included in all Pescador MVP
 apps. The first module is the one we defined within this class, for global
 bindings. The second module belongs to our Query Component.
 </p>
 <p>
 Of course, most applications will have more than one component. The
 <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/GinModule.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>GinModule</code></a>s for all components should be
 brought in like this, just as we do for the Query Component.
 </p>
 <p>
 The last step in global application setup is to inject our components in the
 constructor of our subclass of
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/GlobalSetup.html" title="class in mx.org.pescadormvp.core.client.components"><code>GlobalSetup</code></a>, and tell the
 superclass about them, as shown:
 </p>
 
 <pre>
 <code class=java>
     @Inject
     public ActiveGlobalSetup(QueryComponent queryComponent) {
 
         // Register components
         addComponents(queryComponent);
     }
 </code>
 </pre>
 
 </p> <h3><a name="frameworkstartup"/>Starting Up the Framework</h3>
 <p>
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/GlobalSetup.html" title="class in mx.org.pescadormvp.core.client.components"><code>GlobalSetup</code></a> provides two
 static methods for starting up the application. They're static so they can be
 accessed <b>before</b> DI gets going.
 </p>
 <p>
 While it's possible to call these methods directly from your
 <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/core/client/EntryPoint.html?is-external=true" title="class or interface in com.google.gwt.core.client"><code>EntryPoint</code></a> class, the recommended strategy
 is to call one of them from a static method in your subclass of
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/GlobalSetup.html" title="class in mx.org.pescadormvp.core.client.components"><code>GlobalSetup</code></a>, and call
 <b>that</b> method from your <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/core/client/EntryPoint.html?is-external=true" title="class or interface in com.google.gwt.core.client"><code>EntryPoint</code></a>.
 That way, you keep all global setup code inside your subclass of
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/GlobalSetup.html" title="class in mx.org.pescadormvp.core.client.components"><code>GlobalSetup</code></a>. This is the
 approach used in the example app.
 </p>
 <p>
 Here is the example app's entry point:
 </p>
 
 <pre>
 <code class=java>
     public class JSONPExample implements EntryPoint {
     
         @Override
         public void onModuleLoad() {
             ActiveGlobalSetup.startUp();
         }
     }
 </code>
 </pre>
 <p>
 And here's
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveGlobalSetup.html#startUp()"><code>ActiveGlobalSetup.startUp()</code></a>:
 </p>
 
 <pre>
 <code class=java>
     public static void startUp() {
         
         PescadorMVPGinjectorHolder ginjectorHolder = 
                 new PescadorMVPGinjectorHolder() {
 
             @Override
             public PescadorMVPGinjector getPescadorMVPGinjector() {
                 return GWT.create(ActiveGlobalSetupGinjector.class);
             }
         };
         
         // Inject external Javascript libraries for OpenLayers, display 
         // a loading image if the scripts take a long time to load,
         // and start up the application.
         GlobalSetup.loadJSthenStartUp(
                 ginjectorHolder,
                 new InitialLoadingTimer(),
                 true,
                 "JSONPExample/js/gwt-openlayers/util.js",
                 "http://www.openlayers.org/api/OpenLayers.js",
                 "http://www.openstreetmap.org/openlayers/OpenStreetMap.js");
     }
 </code>
 </pre>
 <p>
 Startup in the example app is a bit more complicated than in most cases,
 because our OpenLayers map widget relies on Javascript libraries that must be
 loaded before the widget can be used. The static method
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/GlobalSetup.html#loadJSthenStartUp(mx.org.pescadormvp.core.client.components.GlobalSetup.PescadorMVPGinjectorHolder, mx.org.pescadormvp.core.client.components.GlobalSetup.LoadingPleaseWait, boolean, java.lang.String...)"><code>GlobalSetup.loadJSthenStartUp()</code></a> helps us handle such cases. We send it the
 URLs of the Javascript libraries to load and a wrapper containing our
 <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/Ginjector.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>Ginjector</code></a>. It will ensure the Javascript
 is loaded before the <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/Ginjector.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>Ginjector</code></a> is
 created. We also send it a widget that displays an egg timer to tell the user
 the page is loading. This image will appear if it take a long time to get the
 Javascript.
 </p>
 <p>
 If you don't need to load any Javascript libraries before starting your app,
 you can use the much simpler
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/GlobalSetup.html#startUp(mx.org.pescadormvp.core.client.PescadorMVPGinjector)"><code>GlobalSetup.startUp(PescadorMVPGinjector)</code></a>
 method, instead.
 </p>
 <h3><a name="tests"/>Tests</h3>
 <p>
 One of the biggest reasons for using DI is to facilitate testing. So, no
 demonstration of a DI-based framework would be complete without some juicy
 unit tests!
 </p>
 <p>
 The example app, like many GWT apps, has two kinds of tests: those that
 require a browser, and those that run on a plain JVM. (Tests of the second
 kind are preferable because they're faster.)
 </p>
 <p>
 The tests are run automatically by Maven when the example app is built (see
 the <a href=
 "https://github.com/AndrewGreen/pescadormvp#how-to-compile-run-and-debug">
 README</a>). We use <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/junit/tools/GWTTestSuite.html?is-external=true" title="class or interface in com.google.gwt.junit.tools"><code>GWTTestSuite</code></a> and the
 <a href="http://mojo.codehaus.org/gwt-maven-plugin/user-guide/testing.html">
 naming conventions provided by the gwt-maven-plugin</a> to specify how and
 when tests should be run.
 </p>
 <p>
 For example, here is the test for
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/GetLatLonActionHelperImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>GetLatLonActionHelperImpl</code></a>
 :
 </p>
 
 <pre>
 <code class=java>
      public class GetLatLonActionHelperImplTestGwt extends GWTTestCase {
         
         @Override
         public String getModuleName() {
             return "mx.org.pescadormvp.examples.jsonp.JSONPExample";
         }
     
         public void testInstantiateResultWithData() {
             GetLatLonActionHelperImpl helper = new GetLatLonActionHelperImpl();
             GetLatLonResult result = helper.insantiateResult(getJSObjectWihData());
             assertTrue(result.hasData());
             assertEquals(result.getDisplayName(), "Somewhere, someplace");
             assertEquals(result.getLat(), 45.5224507);
             assertEquals(result.getLon(), -73.5912827);
         }
         
         public void testInstantiateResultWithoutData() {
             GetLatLonActionHelperImpl helper = new GetLatLonActionHelperImpl();
             GetLatLonResult result = helper.insantiateResult(getJSObjectWithoutData());
             assertFalse(result.hasData());
         }
         
         private final native JavaScriptObject getJSObjectWihData()  /*-{
             return [
                       {
                           "display_name": "Somewhere, someplace",
                           "lat": "45.5224507",
                           "lon": "-73.5912827",
                       }
                    ];
         }-*/;
         
         private final native JavaScriptObject getJSObjectWithoutData()  /*-{
             return [ ];
         }-*/;
     }
 </code>
 </pre>
 <p>
 This test requires a browser because it verifies that a native Javascript
 object is correctly converted to a GWT Java object. (In fact, Maven doesn't
 run it in a real browser, but in <a
 href="http://htmlunit.sourceforge.net/">HtmlUnit</a>, a gui-less, simulated
 browser for testing Java-based Web applications.)
 </p>
 <p>
 The test for
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivityImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryActivityImpl</code></a>, on
 the other hand, is JVM-only. For this kind of test, the example app uses <a
 href="https://github.com/ArcBees/Jukito">Jukito</a>, which provides <a
 href="http://code.google.com/p/mockito/">Mockito</a> and DI support for tests
 in GWT. Here's a fragment of that test:
 </p>
 
 <pre>
 <code class=java>
     @Test
     public void testNoSuchPlace() {
         startTestActivity(true, true, false);
 
         InOrder inOrder = inOrder(queryView);
         inOrder.verify(queryView).scheduleLoadingMessage();
         inOrder.verify(queryView).renderNoSuchPlace();
     }
     
     private QueryActivity startTestActivity(
             boolean placeHasData,
             boolean jsonpCallSucceeds,
             boolean resultHasData) {
 
         QueryActivity activity = activitiesFactory.create();
 
         QueryPlace mockedPlace = placeHasData ? mockedPlaceWithData : mockedPlaceEmpty;
         activity.setPlace(mockedPlace);
         
         MockDataManager mockDataManager = (MockDataManager) dataManager;
         mockDataManager.setSucceed(jsonpCallSucceeds);
         GetLatLonResult result = resultHasData ? resultWithData : resultWithoutData;  
         mockDataManager.setResult(result);
         
         activity.start(panel, eventBus);
         return activity;
     }
 </code>
 </pre>
 <p>
 Here, <code>testNoSuchPlace()</code> requests a test activity with a
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlace</code></a> containing
 location information and a mock
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a> that will appear to
 perform a successful JSONP call and return a
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/GetLatLonResult.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>GetLatLonResult</code></a> with
 no data. (A dataless result means the server couldn't find a place with the
 name indicated.) Then it uses Mockito's <a href="http://docs.mockito.googlecode.com/hg/latest/org/mockito/InOrder.html?is-external=true" title="class or interface in org.mockito"><code>InOrder</code></a> to verify
 that the activity sets up the view as expected.
 </p>
 <p>
 See the source code for more test examples.
 </p>
 <ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveGlobalSetup.ActiveGlobalSetupGinjector.html" title="interface in mx.org.pescadormvp.examples.jsonp.client">ActiveGlobalSetup.ActiveGlobalSetupGinjector</a></td>
<td class="colLast">
<div class="block">Activate all necessary <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/GinModule.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>GinModule</code></a>s for DI in the components to use,
 as well as for basic infrastructure.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveGlobalSetup.html" title="class in mx.org.pescadormvp.examples.jsonp.client">ActiveGlobalSetup</a></td>
<td class="colLast">
<div class="block">This class, together with its inner classes and interfaces, provides the 
 app's global setup.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveGlobalSetup.ActiveGlobalSetupGinModule.html" title="class in mx.org.pescadormvp.examples.jsonp.client">ActiveGlobalSetup.ActiveGlobalSetupGinModule</a></td>
<td class="colLast">
<div class="block">Local GIN module, with global bindings for this app.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/InitialLoadingTimer.html" title="class in mx.org.pescadormvp.examples.jsonp.client">InitialLoadingTimer</a></td>
<td class="colLast">
<div class="block">
 Class for showing an initial loading timer while external JS resources are
 loaded.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/JSONPExample.html" title="class in mx.org.pescadormvp.examples.jsonp.client">JSONPExample</a></td>
<td class="colLast">
<div class="block">This class is the entry point&mdash;where GWT client code starts executing.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../mx/org/pescadormvp/core/shared/package-summary.html">Prev Package</a></li>
<li><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?mx/org/pescadormvp/examples/jsonp/client/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2013. All Rights Reserved.</small></p>
</body>
</html>
