<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="es">
<head>
<!-- Generated by javadoc (version 1.7.0_25) on Sun Jul 28 13:36:14 CDT 2013 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>mx.org.pescadormvp.examples.jsonp.client (Pescador MVP Parent 1.0-SNAPSHOT API)</title>
<meta name="date" content="2013-07-28">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="mx.org.pescadormvp.examples.jsonp.client (Pescador MVP Parent 1.0-SNAPSHOT API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../mx/org/pescadormvp/core/shared/package-summary.html">Prev Package</a></li>
<li><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?mx/org/pescadormvp/examples/jsonp/client/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;mx.org.pescadormvp.examples.jsonp.client</h1>
</div>
<div class="contentContainer">

<a name="package_description">
<!--   -->
</a>
<h2 title="JSONP Example">JSONP Example</h2>
<div class="block"><p>
 JSONP Example is a sample application that demonstrates basic Pescador MVP
 usage.
 </p>
 <p>
 The application asks the user to enter a place name. Then, it fetches the
 place's latitude and longitude via a JSONP request to OpenStreetMap, and
 displays a map using OpenLayers. <a href=
 "http://andrewgreen.github.io/pescadormvp/site/examples/jsonp/live/index.html"
 >Here it is</a>, compiled and running in your browser.
 </p>
 <p>
 Here's how it works.
 </p>
 <h4>Contents:</h4>
 <ol>
 <li><a href="#component">The Query Component</a></li>
 <li><a href="#generalqcstuff">General Query Component Stuff</a></li>
 <li><a href="#queryactivity">The Query Activity</a></li>
 <li><a href="#queryview">The Query View</a></li>
 <li><a href="#map">The Map Widget</a></li>
 <li><a href="#queryplace">The Query Place</a></li>
 <li><a href="#actionhelper">The JSONP Action Helper</a></li>
 <li><a href="#layout">Application Layout</a></li>
 <li><a href="#generalsetup">General Setup</a></li>
 <li><a href="#tests">Tests</a></li>
 </ol>
 <h3><a name="component"/>The Query Component</h3>
 <p>
 In Pescador MVP, you create a component by grouping some classes together in
 a package, and making one of those classes implement the
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a> interface.
 </p>
 <p>
 The JSONP Example application is so simple that it has only one component:
 "Query". All the classes that are part of this component are in the
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/package-summary.html"><code>...examples.jsonp.client.query</code></a> package.
 </p>
 <p>
 Since we're using dependency injection, we want to define variables using
 only interfaces as much as possible. So the public methods of almost every
 concrete class are set out in a corresponding interface, which is used in
 variable definitions. Interfaces have nearly the same name as the concrete
 classes that implement them (the difference is just that concrete class names
 have an "Impl" on the end).
 </p>
 <p>
 Here are the Query Component's interface-implementation pairs:
 </p>
 <table class="packageSummary" border="0" cellpadding="3" cellspacing="0">
 <tr>
 <th class="colFirst" scope="col">Interface</th>
 <th class="colFirst" scope="col">Implementation</th>
 <th class="colOne" scope="col">Description</th>
 </tr>
 <tbody>
 <tr class="rowColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html"
 > QueryComponent</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html"
 > QueryComponentImpl</a></td>
 <td class="colOne"><div class="block">General Query Component stuff.</div></td>
 </tr>
 <tr class="altColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivity.html"
 > QueryActivity</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivityImpl.html"
 > QueryActivityImpl</a></td>
 <td class="colOne"><div class="block">The activity associated with this
 component and the main (and only) region of the UI.</div></td>
 </tr>
 <tr class="rowColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryView.html"
 > QueryView</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryViewImpl.html"
 > QueryViewImpl</a></td>
 <td class="colOne"><div class="block">The view associated with this component
 and the main (and only) region of the UI.</div></td>
 </tr>
 <tr class="altColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/OSMMap.html"
 > OSMMap</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/OSMMapImpl.html"
 > OSMMapImpl</a></td>
 <td class="colOne"><div class="block">The map widget.</div></td>
 </tr>
 <tr class="rowColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html"
 > QueryPlace</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlaceImpl.html"
 > QueryPlaceImpl</a></td>
 <td class="colOne"><div class="block">The place associated with this
 component.</div></td>
 </tr>
 <tr class="altColor">
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/GetLatLonActionHelper.html"
 > GetLatLonActionHelper</a></td>
 <td class="colFirst"><a href=
 "../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/GetLatLonActionHelperImpl.html"
 > GetLatLonActionHelperImpl</a></td>
 <td class="colOne"><div class="block">A helper for performing JSONP requests
 to OpenStreetMap.</div></td>
 </tr>
 </tbody>
 </table>
 <p>
 Let's look at each of these pairs, one by one.
 </p>
 <h3><a name="generalqcstuff"/>General Query Component Stuff</h3>
 <p>
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>
 takes responsibility for everything of general interest to the Query
 Component. One such responsibility is the implementation
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a>&mdash;Pescado MVP
 requires that all components include an implementation of that interface.
 </p>
 <p>
 However, Query Component is not just an ordinary component&mdash;it's a
 "place-activity-view" (PAV) component. That is, it's a special kind of
 component that associates a place class with one or more activity classes,
 view classes, and regions of the UI. Pescado MVP requires that PAV components
 include an implementation of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a>
 (a subinterface of
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a>).
 </p>
 <p>
 The <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a>
 interface is a subinterface of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a>
 . So
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>, by
 implementing
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a>, also
 implements
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a>
 and <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a>.
 </p>
 <p>
 Here is the definition of
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a>:
 </p>
 
 <pre>
 <code class=java>
     public interface QueryComponent extends PAVComponent&lt;
             QueryComponent, 
             QueryPlace>,
             RawDefaultPlaceProvider { }
 </code>
 </pre>
 <p>
 As you can see,
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponent.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponent</code></a> fills
 in the generic parameters of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a>
 . (For now, don't worry about the reference to
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/RawDefaultPlaceProvider.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>RawDefaultPlaceProvider</code></a>
 &mdash;it'll be explained in a moment.) The opening line of
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponent.html" title="interface in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponent</code></a>
 goes like this:
 </p>
 
 <pre>
 <code class=java>
     public interface PAVComponent&lt;
             I extends PAVComponent&lt;I,P>, // component's interface
             P extends PescadorMVPPlace>  // place
             extends Component&lt;I>
 </code>
 </pre>
 <p>
 Now let's look at the implementation,
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>,
 which starts out like this:
 </p>
 
 <pre>
 <code class=java>
     public class QueryComponentImpl extends PAVComponentBase&lt; 
             QueryComponent,
             QueryPlace>
             implements
             QueryComponent
 </code>
 </pre>
 <p>
 By extending
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PAVComponentBase.html" title="class in mx.org.pescadormvp.core.client.placesandactivities"><code>PAVComponentBase</code></a>
 (as all PAV components should)
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>
 gains access to many convenience methods for dealing with places, activities
 and UI regions.
 </p>
 <p>
 What actual logic goes in
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>?
 First, in Pescador MVP, if a component provides any extra functionality to
 other parts of the system, that functionality should be made available via
 the class that implements
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a> (in this case,
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>).
 The Query Component offers only one method of this sort,
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html#getRawDefaultPlace()"><code>getRawDefaultPlace()</code></a>, which provides the application's default place. (More
 about this in a minute.)
 </p>
 <p>
 Dependency injection bindings also are of general interest to the component,
 so they, too, should be placed in the class that implements
 <a href="../../../../../../mx/org/pescadormvp/core/client/components/Component.html" title="interface in mx.org.pescadormvp.core.client.components"><code>Component</code></a>.
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>
 contains a static inner class that implements
 <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/GinModule.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>GinModule</code></a> and sets all the component's
 DI bindings:
 </p>
 
 <pre>
 <code class=java>
     public static class QueryGinModule extends AbstractGinModule {
 
         @Override
         protected void configure() {
             // Bind the component interface to its implementation
             // (which is the enclosing class).
             // This is something all components will do.
             bind(QueryComponent.class).
                     to(QueryComponentImpl.class).in(Singleton.class);
 
             // Create the places factory.
             // All place-activity-view components will do this.
             install(new GinFactoryModuleBuilder().implement(
                     QueryPlace.class, QueryPlaceImpl.class)
                     .build(
                     new TypeLiteral&lt;
                     RawPlaceFactory&lt;QueryPlace>>(){}));
 
             // The next two bindings are for the activity and the view.
             // Place-activity-view components will have bindings like these 
             // for each activity and view they define.
             // (This component has only one activity and one view.)
             
             // Create the activities factory.
             install(new GinFactoryModuleBuilder().implement(
                     QueryActivity.class, QueryActivityImpl.class)
                     .build(
                     new TypeLiteral&lt;
                     ActivitiesFactory&lt;QueryPlace, QueryActivity>>(){}));
             
             // Bind the view.
             bind(QueryView.class).to(QueryViewImpl.class)
                     .in(Singleton.class);
             
             // The remaining bindings are specific to this component.
             // Other place-activity-view components may or may not have
             // additional bindings like these, depending on what they do.
             
             // Bind JSONP action helper.
             // Any component that sets up JSONP requests will do something
             // like this.
             bind(GetLatLonActionHelper.class)
                     .to(GetLatLonActionHelperImpl.class)
                     .in(Singleton.class);
             
             // Bind OSMMap widget.
             bind(OSMMap.class).to(OSMMapImpl.class).in(Singleton.class);
         }
     }
 </code>
 </pre>
 <p>
 The remaining general setup is performed in
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryComponentImpl.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryComponentImpl</code></a>'s
 constructor:
 </p>
 
 <pre>
 <code class=java>
     @Inject
     public QueryComponentImpl(
             ActivitiesFactory&lt;QueryPlace, QueryActivity> activitiesFactory,
             GetLatLonActionHelper actionHelper,
             DataManager dataManager) {
         
         // Establish that this component has an activity for the
         // Layout.Body screen region (in this app, that's the only region).
         addRegionAndActivitiesFactory(Body.class, activitiesFactory);
 
         // register JSONP action helper for getting lat-lon data
         dataManager.registerActionHelper(actionHelper);
     }
 </code>
 </pre>
 <p>
 Here, we link the UI region
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/Layout.Body.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.layout"><code>Layout.Body</code></a> to the activities factory we created in our
 <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/GinModule.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>GinModule</code></a> (see above). This provides the
 framework with everything it needs to activate the
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivity.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryActivity</code></a> and
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryView.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryView</code></a> in the
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/Layout.Body.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.layout"><code>Layout.Body</code></a> UI region when the application goes to
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlace</code></a>.
 </p>
 <p>
 Finally, we register a
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/JsonpActionHelper.html" title="interface in mx.org.pescadormvp.core.client.data"><code>JsonpActionHelper</code></a> with the
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a>. This is necessary
 for the JSONP requests the component will perform (more about
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/JsonpActionHelper.html" title="interface in mx.org.pescadormvp.core.client.data"><code>JsonpActionHelper</code></a>s below).
 </p>
 <p>
 If you find all of the above a bit boilerplatey, you're right! Admittedly, it
 would be possible to set up some fancy code generation to make PAV component
 creation easier. Nonetheless, it's not an onerous amount of boilerplate, and
 it does help you organize your dependency-injected MVP-architected code.
 </p>
 <h3><a name="queryactivity"/>The Query Activity</h3>
 <p>
 This is the fun part: the activity. Here's the constructor:
 </p>
 
 <pre>
 <code class=java>
        @Inject
        public QueryActivityImpl(
                        QueryComponent queryComponent,
                        QueryMessages messages,
                        OSMMap map,
                        DataManager dataManager,
                        PescadorMVPLogger logger) {
 
                this.queryComponent = queryComponent;
                this.messages = messages;
                this.map = map;
                this.dataManager = dataManager;
                this.logger = logger;
        }
 </code>
 </pre>
 <p>
 OK, that's pretty straightforward. We get everything we need via DI and store
 it all in instance variables.
 </p>
 <p>
 The activity's
 <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/activity/shared/Activity.html?is-external=true#start(com.google.gwt.user.client.ui.AcceptsOneWidget, com.google.gwt.event.shared.EventBus)" title="class or interface in com.google.gwt.activity.shared"><code>start()</code></a> method is also unsurprising&mdash;after all, this is a standard GWT
 <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.5/com/google/gwt/activity/shared/Activity.html?is-external=true" title="class or interface in com.google.gwt.activity.shared"><code>Activity</code></a>:
 </p>
 
 <pre>
 <code class=java>
     @Override
     public void start(AcceptsOneWidget container, EventBus eventBus) {
 
         // Attach the view to the container for this region of the layout.
         // (In this example there's only one region.)
         QueryView view = getView(); 
         contaier.setWidget(view);
         ...
 </code>
 </pre>
 <p>
 The only unusual thing here is that we conveniently have access to our view
 via the
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPActivityBase.html#getView()"><code>getView()</code></a> method.
 </p>
 <p>
 Standard Pescador MVP fare is to have the activity push to and control the
 view. The view doesn't do anything except control UI details and fire off
 events.
 </p>
 <p>
 The first thing we do with our passive view is ask it if the query area
 (where the user will enter information) has been rendered. If it hasn't, we
 tell the view to render it.
 </p>
 
 <pre>
 <code class=java>
         if (!view.isQueryAreaRendered()) {
 
             view.renderQueryArea(
                     messages.beforeQueryTextBox(),
                     messages.afterQueryTextBox());
         }
 </code>
 </pre>
 <p>
 Then, we register to receive events from the view, and call
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivityImpl.html#doQuery()"><code>doQuery()</code></a> (where the real action takes place):
 </p>
 
 <pre>
 <code class=java>
         linkHandlerReg = eventBus.addHandlerToSource(
                 ActivateInternalLinkEvent.TYPE,
                 view, this);
 
          doQuery();
      }
 </code>
 </pre>
 <p>
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryView.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryView</code></a> has five
 renderable states:
 </p>
 <ol>
 <li><i>Empty</i>&nbsp;&nbsp;&nbsp;In this state, no messages or information
 are shown.</li>
 <li><i>Loading</i>&nbsp;&nbsp;&nbsp;The view displays a message saying that
 the requested information is loading.</li>
 <li><i>Error</i>&nbsp;&nbsp;&nbsp;The view displays a message explaining that
 there was an error communicating with the server.</li>
 <li><i>Lat-lon</i>&nbsp;&nbsp;&nbsp;The view displays a place's latitude and
 longitude, and a map.</li>
 <li><i>No such place</i>&nbsp;&nbsp;&nbsp;The view displays a message
 explaining that no place was found with the name entered.</li>
 </ol>
 <p>
 It's the activity's responsibility to tell the view which state to render,
 and to provide it with the information it needs to do so.
 </p>
 <p>
 So, in
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryActivityImpl.html#doQuery()"><code>doQuery()</code></a>, the activity first gets the name of the location the user wants
 to hear about. It gets this information from the current
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlace</code></a> instance,
 available via the
 <a href="../../../../../../mx/org/pescadormvp/core/client/placesandactivities/PescadorMVPPlaceActivityBase.html#getPlace()"><code>getPlace()</code></a> method. If the current Place has no information on this, then the
 activity tells the view to render an empty state.
 </p>
 
 <pre>
 <code class=java>
         final String location = getPlace().getLocation();
         
         // If there's no location data, set up the view as "empty"
         if ((location == null) || (location.length() == 0)) {
             view.setTextboxContents("");
             view.renderEmpty();
 </code>
 </pre>
 <p>
 On the other hand, if the
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/QueryPlace.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>QueryPlace</code></a> <i>does</i>
 have the name of a location to be queried, then the activity sends a request
 to the <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a>, and decides
 what to do on the basis of the result. Here's the code:
 </p>
 
 <pre>
 <code class=java>
         } else {
             
             // Make sure the text box contains the location string the user asked for
             // We don't sanitize it here, that's for the view to do
             view.setTextboxContents(location);
             
             // Before trying to retrieve information,
             // set a timer to display a "Loading" message if the request
             // doesn't come back quickly. The view will cancel the timer
             // once any state is rendered.
             view.setLoadingString(messages.loading());
             view.scheduleLoadingMessage();
                         
             // Create an action object with the name of the location to query
             GetLatLonAction action = new GetLatLonAction(location);
             
             // Perform the request
             dataManager.execute(action, GetLatLonResult.class,
                     new AsyncCallback&lt;GetLatLonResult>() {
     
                 @Override
                 public void onFailure(Throwable caught) {
                     
                     // Log the error
                     logger.log(Level.WARNING, caught.getLocalizedMessage());
                     
                     // Notify the user
                     view.setErrorStrings(messages.errorCommunicating(),
                             messages.tryAgain());
                     view.renderError();
                 }
         
                 @Override
                 public void onSuccess(GetLatLonResult result) {
                     
                     if (result.isValid()) {
                         
                         double lat = result.getLat();
                         double lon = result.getLon();
                         
                         String latNSStr = lat > 0 ? "N" : "S";
                         String latStr = Math.abs(lat) + " " + latNSStr;
                         
                         String lonEWStr = lon > 0 ? "E" : "W";
                         String lonStr = Math.abs(lon) + " " + lonEWStr;
                         
                         String info = messages.XisAtY(
                                 result.getDisplayName(), latStr, lonStr);
                         
                         // Send the info to the view
                         view.setLatLonMsg(info);
                         
                         // Ensure the view has the map it will use
                         if (!view.osmMapSet())
                             view.setOSMMap(map);
                         
                         // Set the map to the correct location
                         map.setLatLon(lat, lon);
                         
                         // Tell the view to render
                         view.renderLatLon();
 
                     } else {
                         
                         view.setNoSuchPlaceStrings(
                                 messages.neverHeardOf(location),
                                 messages.tryAgain());
                         
                         view.renderNoSuchPlace();
                     }
                 }
             });
         }
 </code>
 </pre>
 <p>
 In summary, we tell the view to set the contents of the text box with the
 name of the location being queried, and to start a timer and render the
 Loading state if it doesn't hear back from us right away. Then we create a
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/GetLatLonAction.html" title="class in mx.org.pescadormvp.examples.jsonp.client.query"><code>GetLatLonAction</code></a> with
 the name of the location to query, and send it to the (third-party) server
 via the <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a>. When the
 request comes back, we tell the view to render Error, Lat-lon or No such
 place, depending on the result. We also provide the view with the localized
 messages it needs to do this. If the Lat-lon state is to be rendered, we also
 do a bit of string processing, set the map location and make sure the view
 has the required map widget (
 <a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/query/OSMMap.html" title="interface in mx.org.pescadormvp.examples.jsonp.client.query"><code>OSMMap</code></a>&mdash; see
 below).
 </p>
 <p>
 In truth, there's not much extraordinary about this activity. The most
 significant things about it are: we get everything we need via DI and methods
 provided by the superclass, push to the view and handle events from it, and
 send requests via a handy
 <a href="../../../../../../mx/org/pescadormvp/core/client/data/DataManager.html" title="interface in mx.org.pescadormvp.core.client.data"><code>DataManager</code></a> that uses the command
 pattern (more on that below).
 </p>
 <h3><a name="queryview"/>The Query View</h3>
 <p>
 <i>[TODO]</i>
 </p>
 <h3><a name="map"/>The Map Widget</h3>
 <p>
 <i>[TODO]</i>
 </p>
 <h3><a name="queryplace"/>The Query Place</h3>
 <p>
 <i>[TODO]</i>
 </p>
 <h3><a name="actionhelper"/>The JSONP Action Helper</h3>
 <p>
 <i>[TODO]</i>
 </p>
 <h3><a name="layout"/>Application Layout</h3>
 <p>
 <i>[TODO]</i>
 </p>
 <h3><a name="generalsetup"/>General Setup</h3>
 <p>
 <i>[TODO]</i>
 </p>
 <h3><a name="tests"/>Tests</h3>
 <p>
 <i>[TODO]</i>
 </p>
 <ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveComponentSetup.ActiveSetupGinjector.html" title="interface in mx.org.pescadormvp.examples.jsonp.client">ActiveComponentSetup.ActiveSetupGinjector</a></td>
<td class="colLast">
<div class="block">Activate all necessary <a href="http://google-gin.googlecode.com/svn/trunk/javadoc/com/google/gwt/inject/client/GinModule.html?is-external=true" title="class or interface in com.google.gwt.inject.client"><code>GinModule</code></a>s for DI in the components to use,
 as well as for basic infrastructure.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveComponentSetup.html" title="class in mx.org.pescadormvp.examples.jsonp.client">ActiveComponentSetup</a></td>
<td class="colLast">
<div class="block">This class, together with its inner classes and interfaces, provides a full
 configuration of the modular framework.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/ActiveComponentSetup.ActiveSetupGinModule.html" title="class in mx.org.pescadormvp.examples.jsonp.client">ActiveComponentSetup.ActiveSetupGinModule</a></td>
<td class="colLast">
<div class="block">Local GIN module, with general bindings for this app 
 that are not part of the larger framework.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/InitialLoadingTimer.html" title="class in mx.org.pescadormvp.examples.jsonp.client">InitialLoadingTimer</a></td>
<td class="colLast">
<div class="block">
 Class for showing an initial loading timer while external JS resources are
 loaded.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/JSONPExample.html" title="class in mx.org.pescadormvp.examples.jsonp.client">JSONPExample</a></td>
<td class="colLast">
<div class="block">This class is the entry point--where GWT client code starts executing.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
 
 </div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../mx/org/pescadormvp/core/shared/package-summary.html">Prev Package</a></li>
<li><a href="../../../../../../mx/org/pescadormvp/examples/jsonp/client/layout/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?mx/org/pescadormvp/examples/jsonp/client/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2013. All Rights Reserved.</small></p>
</body>
</html>
